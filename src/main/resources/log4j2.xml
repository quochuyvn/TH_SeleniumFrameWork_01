<?xml version="1.0" encoding="UTF-8"?>

<!--
====================================================
 LOG4J2 CONFIG – ENTERPRISE STANDARD FOR SELENIUM
====================================================
- Tách log theo package
- Async logging (performance)
- Error log riêng
- Rolling theo ngày + size
====================================================
-->

<Configuration status="WARN" monitorInterval="30"
               xmlns="http://logging.apache.org/log4j/2.0/config"
               xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
               xsi:schemaLocation="http://logging.apache.org/log4j/2.0/config
                                   https://raw.githubusercontent.com/apache/logging-log4j2/main/log4j-core/src/main/resources/Log4j-config.xsd">

    <!-- ===================== -->
    <!-- Global Properties -->
    <!-- ===================== -->
    <Properties>
        <Property name="log-path">./logs</Property>

        <Property name="log-pattern">
            %d{yyyy-MM-dd HH:mm:ss.SSS} [%t] %-5level %c{1}:%L - %msg%n
        </Property>
    </Properties>

    <!-- ===================== -->
    <!-- Appenders -->
    <!-- ===================== -->
    <Appenders>

        <!-- Console -->
        <Console name="Console" target="SYSTEM_OUT">
            <PatternLayout pattern="${log-pattern}"/>
        </Console>

        <!-- ===================== -->
        <!-- MAIN / ROOT LOG -->
        <!-- ===================== -->
        <RollingFile name="AppFile"
                     fileName="${log-path}/automation.log"
                     filePattern="${log-path}/automation-%d{yyyy-MM-dd}-%i.log.gz">
            <PatternLayout pattern="${log-pattern}"/>
            <Policies>
                <TimeBasedTriggeringPolicy/>
                <SizeBasedTriggeringPolicy size="5MB"/>
            </Policies>
            <DefaultRolloverStrategy max="14"/>
        </RollingFile>

        <!-- ===================== -->
        <!-- ERROR LOG -->
        <!-- ===================== -->
        <RollingFile name="ErrorFile"
                     fileName="${log-path}/error.log"
                     filePattern="${log-path}/error-%d{yyyy-MM-dd}.log.gz">
            <PatternLayout pattern="${log-pattern}"/>
            <Filters>
                <ThresholdFilter level="ERROR"
                                 onMatch="ACCEPT"
                                 onMismatch="DENY"/>
            </Filters>
            <Policies>
                <TimeBasedTriggeringPolicy/>
            </Policies>
        </RollingFile>

        <!-- ===================== -->
        <!-- PAGES LOG -->
        <!-- ===================== -->
        <RollingFile name="PagesFile"
                     fileName="${log-path}/pages.log"
                     filePattern="${log-path}/pages-%d{yyyy-MM-dd}-%i.log.gz">
            <PatternLayout pattern="${log-pattern}"/>
            <Policies>
                <TimeBasedTriggeringPolicy/>
                <SizeBasedTriggeringPolicy size="5MB"/>
            </Policies>
        </RollingFile>

        <!-- ===================== -->
        <!-- TESTS LOG -->
        <!-- ===================== -->
        <RollingFile name="TestsFile"
                     fileName="${log-path}/tests.log"
                     filePattern="${log-path}/tests-%d{yyyy-MM-dd}-%i.log.gz">
            <PatternLayout pattern="${log-pattern}"/>
            <Policies>
                <TimeBasedTriggeringPolicy/>
                <SizeBasedTriggeringPolicy size="5MB"/>
            </Policies>
        </RollingFile>

        <!-- ===================== -->
        <!-- UTILS LOG -->
        <!-- ===================== -->
        <RollingFile name="UtilsFile"
                     fileName="${log-path}/utils.log"
                     filePattern="${log-path}/utils-%d{yyyy-MM-dd}-%i.log.gz">
            <PatternLayout pattern="${log-pattern}"/>
            <Policies>
                <TimeBasedTriggeringPolicy/>
                <SizeBasedTriggeringPolicy size="5MB"/>
            </Policies>
        </RollingFile>

        <!-- ===================== -->
        <!-- ASYNC APPENDERS -->
        <!-- ===================== -->
        <Async name="AsyncRoot">
            <AppenderRef ref="AppFile"/>
            <AppenderRef ref="ErrorFile"/>
        </Async>

        <Async name="AsyncPages">
            <AppenderRef ref="PagesFile"/>
            <AppenderRef ref="ErrorFile"/>
        </Async>

        <Async name="AsyncTests">
            <AppenderRef ref="TestsFile"/>
            <AppenderRef ref="ErrorFile"/>
        </Async>

        <Async name="AsyncUtils">
            <AppenderRef ref="UtilsFile"/>
            <AppenderRef ref="ErrorFile"/>
        </Async>

        <!-- ===================== -->
        <!-- CONFIG LOG -->
        <!-- ===================== -->
        <RollingFile name="ConfigFile"
                     fileName="${log-path}/config.log"
                     filePattern="${log-path}/config-%d{yyyy-MM-dd}.log.gz">
            <PatternLayout pattern="${log-pattern}"/>
            <Policies>
                <TimeBasedTriggeringPolicy/>
            </Policies>
        </RollingFile>

        <Async name="AsyncConfig">
            <AppenderRef ref="ConfigFile"/>
        </Async>

        <!-- ===================== -->
        <!-- BASE LOG -->
        <!-- ===================== -->
        <RollingFile name="BaseFile"
                     fileName="${log-path}/base.log"
                     filePattern="${log-path}/base-%d{yyyy-MM-dd}-%i.log.gz">
            <PatternLayout pattern="${log-pattern}"/>
            <Policies>
                <TimeBasedTriggeringPolicy/>
                <SizeBasedTriggeringPolicy size="5MB"/>
            </Policies>
        </RollingFile>

        <Async name="AsyncBase">
            <AppenderRef ref="BaseFile"/>
            <AppenderRef ref="ErrorFile"/>
        </Async>

    </Appenders>

    <!-- ===================== -->
    <!-- LOGGERS -->
    <!-- ===================== -->
    <Loggers>

        <!-- Config -->
        <Logger name="config" level="DEBUG" additivity="false">
            <AppenderRef ref="AsyncConfig"/>
            <AppenderRef ref="Console"/>
        </Logger>

        <!-- Base Classes -->
        <Logger name="base" level="DEBUG" additivity="false">
            <AppenderRef ref="AsyncBase"/>
            <AppenderRef ref="Console"/>
            <AppenderRef ref="AsyncRoot"/>
        </Logger>

        <!-- Page Objects -->
        <Logger name="pageObject" level="DEBUG" additivity="false">
            <AppenderRef ref="AsyncPages"/>
            <AppenderRef ref="Console"/>  
            <AppenderRef ref="AsyncRoot"/>
        </Logger>

        <!-- Test Cases -->
        <Logger name="testCases" level="INFO" additivity="false">
            <AppenderRef ref="AsyncTests"/>
            <AppenderRef ref="Console"/>
            <AppenderRef ref="AsyncRoot"/>
        </Logger>

        <!-- Utils -->
        <Logger name="utils" level="DEBUG" additivity="false">
            <AppenderRef ref="AsyncUtils"/>
            <AppenderRef ref="Console"/>
            <AppenderRef ref="AsyncRoot"/>
        </Logger>

        <!-- ROOT -->
        <Root level="INFO">
            <AppenderRef ref="Console"/>
            <AppenderRef ref="AsyncRoot"/>
        </Root>

    </Loggers>

</Configuration>
