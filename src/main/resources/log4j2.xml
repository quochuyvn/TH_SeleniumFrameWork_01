<?xml version="1.0" encoding="UTF-8"?>

<!--
  ðŸ”¥ PRO IMPROVEMENT #1
  status="WARN" : chá»‰ log WARN/ERROR cá»§a Log4j2 engine
  â†’ giáº£m noise, chá»‰ dÃ¹ng DEBUG khi troubleshoot config
  monitorInterval="30" : tá»± reload config má»—i 30s, khÃ´ng cáº§n restart test
-->
<Configuration status="WARN" monitorInterval="30">

    <!-- ===================== -->
    <!-- Global Properties -->
    <!-- ===================== -->
    <Properties>

        <!--
          ðŸ”¥ PRO IMPROVEMENT #2
          DÃ¹ng property cho path â†’ dá»… Ä‘á»•i khi cháº¡y local / CI
        -->
        <Property name="log-path">./logs</Property>

        <!--
          ðŸ”¥ PRO IMPROVEMENT #3
          Log pattern nÃ¢ng cao:
          - CÃ³ milliseconds (SSS)
          - CÃ³ thread name [%t] â†’ báº¯t buá»™c khi cháº¡y parallel
          - Level + class + line number â†’ debug nhanh
        -->
        <Property name="log-pattern">
            %d{yyyy-MM-dd HH:mm:ss.SSS} [%t] %-5level %c{1}:%L - %msg%n
        </Property>
    </Properties>

    <!-- ===================== -->
    <!-- Appenders -->
    <!-- ===================== -->
    <Appenders>

        <!--
          ðŸ”¥ PRO IMPROVEMENT #4
          Console Appender dÃ¹ng cho debug local
          (CI cÃ³ thá»ƒ táº¯t náº¿u cáº§n)
        -->
        <Console name="Console" target="SYSTEM_OUT">
            <PatternLayout pattern="${log-pattern}"/>
        </Console>

        <!--
          ðŸ”¥ PRO IMPROVEMENT #5
          RollingFile cho log chÃ­nh cá»§a automation
          - TÃ¡ch file theo ngÃ y + size
          - File Ä‘ang cháº¡y: automation.log
        -->
        <RollingFile name="AppFile"
                     fileName="${log-path}/automation.log"
                     filePattern="${log-path}/automation-%d{yyyy-MM-dd}-%i.log.gz">

            <PatternLayout pattern="${log-pattern}"/>

            <!--
              ðŸ”¥ PRO IMPROVEMENT #6
              2 Ä‘iá»u kiá»‡n rollover:
              - Theo ngÃ y
              - Theo size (5MB)
            -->
            <Policies>
                <TimeBasedTriggeringPolicy/>
                <SizeBasedTriggeringPolicy size="5MB"/>
            </Policies>

            <!--
              ðŸ”¥ PRO IMPROVEMENT #7
              Giá»¯ tá»‘i Ä‘a 14 file log cÅ© â†’ trÃ¡nh Ä‘áº§y á»• cá»©ng CI
            -->
            <DefaultRolloverStrategy max="14"/>
        </RollingFile>

        <!--
          ðŸ”¥ PRO IMPROVEMENT #8
          File log RIÃŠNG cho ERROR
          â†’ ráº¥t tiá»‡n attach vÃ o Extent Report / Jenkins
        -->
        <RollingFile name="ErrorFile"
                     fileName="${log-path}/error.log"
                     filePattern="${log-path}/error-%d{yyyy-MM-dd}.log.gz">

            <PatternLayout pattern="${log-pattern}"/>

            <!--
              ðŸ”¥ PRO IMPROVEMENT #9
              Chá»‰ accept log level ERROR trá»Ÿ lÃªn
            -->
            <Filters>
                <ThresholdFilter level="ERROR"
                                 onMatch="ACCEPT"
                                 onMismatch="DENY"/>
            </Filters>

            <Policies>
                <TimeBasedTriggeringPolicy/>
            </Policies>
        </RollingFile>

        <!--
          ðŸ”¥ PRO IMPROVEMENT #10 (Ráº¤T QUAN TRá»ŒNG)
          Async Appender:
          - Log khÃ´ng block Selenium WebDriver
          - TÄƒng performance khi cháº¡y parallel / CI
        -->
        <Async name="AsyncFile">
            <AppenderRef ref="AppFile"/>
            <AppenderRef ref="ErrorFile"/>
        </Async>

    </Appenders>

    <!-- ===================== -->
    <!-- Loggers -->
    <!-- ===================== -->
    <Loggers>

        <!--
          ðŸ”¥ PRO IMPROVEMENT #11
          Logger riÃªng cho Page Object
          â†’ DEBUG Ä‘á»ƒ tháº¥y rÃµ tá»«ng hÃ nh Ä‘á»™ng UI
        -->
        <Logger name="pages" level="DEBUG" additivity="false">
            <AppenderRef ref="AsyncFile"/>
        </Logger>

        <!--
          ðŸ”¥ PRO IMPROVEMENT #12
          Logger riÃªng cho Test Case
          â†’ INFO Ä‘á»ƒ log flow test, trÃ¡nh quÃ¡ nhiá»u chi tiáº¿t
        -->
        <Logger name="tests" level="INFO" additivity="false">
            <AppenderRef ref="AsyncFile"/>
        </Logger>

        <!--
          ðŸ”¥ PRO IMPROVEMENT #13
          Logger cho Utils / Helpers
          â†’ DEBUG Ä‘á»ƒ debug retry, wait, excel, api, ...
        -->
        <Logger name="utils" level="DEBUG" additivity="false">
            <AppenderRef ref="AsyncFile"/>
        </Logger>

        <!--
          ðŸ”¥ PRO IMPROVEMENT #14
          Root logger:
          - INFO level cho toÃ n app
          - Ghi log ra Console + AsyncFile
        -->
        <Root level="INFO">
            <AppenderRef ref="Console"/>
            <AppenderRef ref="AsyncFile"/>
        </Root>

    </Loggers>

</Configuration>
